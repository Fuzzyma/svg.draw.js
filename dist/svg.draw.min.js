/*! svg.draw.js v3.0.0 MIT*/;
this.SVG=this.SVG||{},this.SVG.Draw=function(t,o){"use strict";function n(t,i){for(var s=0;s<i.length;s++){var n=i[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var h={snapToGrid:1},l={},e=function(){function a(t,i,s){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,a),(this.el=t).remember("_paintHandler",this),this.start=this.start.bind(this),this.point=this.point.bind(this),this.stop=this.stop.bind(this),this.update=this.update.bind(this),this.done=this.done.bind(this),this.cancel=this.cancel.bind(this);var n=this.getPlugin();for(var e in this.parent=t.parent(),this.p=this.parent.node.createSVGPoint(),this.m=null,this.startPoint=null,this.lastUpdateCall=null,this.options={},h)this.options[e]=h[e],void 0!==s[e]&&(this.options[e]=s[e]);for(var r in n.point&&(n.pointPlugin=n.point,delete n.point),n)this[r]=n[r];i||this.parent.on("click.draw",this.start)}return function(t,i,s){i&&n(t.prototype,i),s&&n(t,s)}(a,[{key:"transformPoint",value:function(t,i){return this.p.x=t-(this.offset.x-window.pageXOffset),this.p.y=i-(this.offset.y-window.pageYOffset),this.p.matrixTransform(this.m)}},{key:"start",value:function(t){this.m=this.el.node.getScreenCTM().inverse(),this.offset={x:window.pageXOffset,y:window.pageYOffset},this.options.snapToGrid*=Math.sqrt(this.m.a*this.m.a+this.m.b*this.m.b),this.startPoint=this.snapToGrid(this.transformPoint(t.clientX,t.clientY)),this.init&&this.init(t),this.el.fire("drawstart",{event:t,p:this.p,m:this.m}),o.on(window,"mousemove.draw",this.update),this.start=this.point}},{key:"point",value:function(t){return this.point!==this.start?this.start(t):this.pointPlugin?this.pointPlugin(t):void this.stop(t)}},{key:"stop",value:function(t){t&&this.update(t),this.clean&&this.clean(),o.off(window,"mousemove.draw"),this.parent.off("click.draw"),this.el.forget("_paintHandler"),this.el.draw=function(){},this.el.fire("drawstop")}},{key:"update",value:function(t){!t&&this.lastUpdateCall&&(t=this.lastUpdateCall),this.lastUpdateCall=t,this.m=this.el.node.getScreenCTM().inverse(),this.calc(t),this.el.fire("drawupdate",{event:t,p:this.p,m:this.m})}},{key:"done",value:function(){this.calc(),this.stop(),this.el.fire("drawdone")}},{key:"cancel",value:function(){this.stop(),this.el.remove(),this.el.fire("drawcancel")}},{key:"snapToGrid",value:function(t){var i=null;if(t.length)return i=[t[0]%this.options.snapToGrid,t[1]%this.options.snapToGrid],t[0]-=i[0]<this.options.snapToGrid/2?i[0]:i[0]-this.options.snapToGrid,t[1]-=i[1]<this.options.snapToGrid/2?i[1]:i[1]-this.options.snapToGrid,t;for(var s in t)i=t[s]%this.options.snapToGrid,t[s]-=(i<this.options.snapToGrid/2?i:i-this.options.snapToGrid)+(i<0?this.options.snapToGrid:0);return t}},{key:"param",value:function(t,i){this.options[t]=null===i?h[t]:i,this.update()}},{key:"getPlugin",value:function(){return l[this.el.type]}}]),a}();function i(t,i){var s={};for(var n in"string"==typeof t?s[t]=i:s=t,s){var e=n.trim().split(o.regex.delimiter);for(var r in e)l[e[r]]=s[n]}}return o.extend(o.Element,{draw:function(t,i,s){t instanceof window.Event||"string"==typeof t||(i=t,t=null);var n=this.remember("_paintHandler")||new e(this,t,i||{});return t instanceof window.Event&&n.start(t),n[t]&&n[t](i,s),this}}),i("circle",{init:function(t){var i=this.startPoint;this.el.attr({cx:i.x,cy:i.y,r:1})},calc:function(t){var i=this.transformPoint(t.clientX,t.clientY),s={cx:this.startPoint.x,cy:this.startPoint.y,r:Math.sqrt((i.x-this.startPoint.x)*(i.x-this.startPoint.x)+(i.y-this.startPoint.y)*(i.y-this.startPoint.y))};this.snapToGrid(s),this.el.attr(s)}}),i("rect image",{init:function(t){var i=this.startPoint;this.el.attr({x:i.x,y:i.y,height:0,width:0})},calc:function(t){var i={x:this.startPoint.x,y:this.startPoint.y},s=this.transformPoint(t.clientX,t.clientY);i.width=s.x-i.x,i.height=s.y-i.y,this.snapToGrid(i),i.width<0&&(i.x=i.x+i.width,i.width=-i.width),i.height<0&&(i.y=i.y+i.height,i.height=-i.height),this.el.attr(i)}}),i("ellipse",{init:function(t){var i=this.startPoint;this.el.attr({cx:i.x,cy:i.y,rx:1,ry:1})},calc:function(t){var i=this.transformPoint(t.clientX,t.clientY),s={cx:this.startPoint.x,cy:this.startPoint.y,rx:Math.abs(i.x-this.startPoint.x),ry:Math.abs(i.y-this.startPoint.y)};this.snapToGrid(s),this.el.attr(s)}}),i("line polyline polygon",{init:function(){this.set=new o.List;var t=this.startPoint,i=[[t.x,t.y],[t.x,t.y]];this.el.plot(i),this.drawCircles()},calc:function(t){var i=this.el.array().valueOf();if(i.pop(),t){var s=this.transformPoint(t.clientX,t.clientY);i.push(this.snapToGrid([s.x,s.y]))}this.el.plot(i),this.drawCircles()},point:function(t){if(-1<this.el.type.indexOf("poly")){var i=this.transformPoint(t.clientX,t.clientY),s=this.el.array().valueOf();return s.push(this.snapToGrid([i.x,i.y])),this.el.plot(s),this.drawCircles(),void this.el.fire("drawpoint",{event:t,p:{x:i.x,y:i.y},m:this.m})}this.stop(t)},clean:function(){this.set.each(function(){this.remove()}),delete this.set},drawCircles:function(){var t=this.el.array().valueOf();this.set.each(function(){this.remove()}),this.set=new o.List;for(var i=0;i<t.length;++i){this.p.x=t[i][0],this.p.y=t[i][1];var s=this.p.matrixTransform(this.parent.node.getScreenCTM().inverse().multiply(this.el.node.getScreenCTM()));this.set.push(this.parent.circle(5).stroke({width:1}).fill("#ccc").center(s.x,s.y))}},undo:function(){this.set.length&&(this.set.splice(-2,1)[0].remove(),this.el.array().value.splice(-2,1),this.el.plot(this.el.array()),this.el.fire("undopoint"))}}),t.registerPlugin=i,t}({},SVG);
//# sourceMappingURL=svg.draw.min.js.map
